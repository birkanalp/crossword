{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "level.schema.json",
  "title": "Crossword Level Schema",
  "description": "Canonical schema for grid_json and clues_json stored in the levels table and returned by getLevel.",
  "contractVersion": "1.0.3",
  "lastUpdated": "2026-02-25",
  "owner": "backend-agent",
  "consumers": ["frontend-agent"],

  "_changelog": [
    { "version": "1.0.3", "date": "2026-02-25", "note": "Contract sync: allow server-only Clue.answer in at-rest levels.clues_json while preserving public API behavior that strips answers." },
    { "version": "1.0.2", "date": "2026-02-24", "note": "Aligned notes with Phase-0 placeholder semantics: clue coverage is required for approved gameplay levels, not placeholder draft outputs." },
    { "version": "1.0.1", "date": "2026-02-24", "note": "Clarified clue-number mapping semantics for placeholder generator output." },
    { "version": "1.0.0", "date": "2026-02-21", "note": "Phase 1 initial schema" }
  ],

  "definitions": {

    "GridCell": {
      "type": "object",
      "required": ["row", "col", "type"],
      "additionalProperties": false,
      "properties": {
        "row": {
          "type": "integer",
          "minimum": 0,
          "description": "0-indexed row position in the grid."
        },
        "col": {
          "type": "integer",
          "minimum": 0,
          "description": "0-indexed column position in the grid."
        },
        "type": {
          "type": "string",
          "enum": ["letter", "black"],
          "description": "'letter' = playable cell. 'black' = blocked cell (dark square)."
        },
        "number": {
          "type": "integer",
          "minimum": 1,
          "description": "Clue number shown in the top-left corner of the cell. Only present on the first cell of an Across or Down word."
        }
      }
    },

    "GridJson": {
      "type": "object",
      "required": ["rows", "cols", "cells"],
      "additionalProperties": false,
      "properties": {
        "rows": {
          "type": "integer",
          "minimum": 3,
          "maximum": 21,
          "description": "Total number of rows in the grid."
        },
        "cols": {
          "type": "integer",
          "minimum": 3,
          "maximum": 21,
          "description": "Total number of columns in the grid."
        },
        "cells": {
          "type": "array",
          "description": "Flat list of all cells. Every (row, col) position within [0, rows) × [0, cols) must appear exactly once.",
          "items": { "$ref": "#/definitions/GridCell" },
          "minItems": 9
        }
      }
    },

    "ClueStart": {
      "type": "object",
      "required": ["row", "col"],
      "additionalProperties": false,
      "properties": {
        "row": { "type": "integer", "minimum": 0 },
        "col": { "type": "integer", "minimum": 0 }
      }
    },

    "Clue": {
      "type": "object",
      "required": ["number", "clue", "answer_length", "start"],
      "additionalProperties": false,
      "properties": {
        "number": {
          "type": "integer",
          "minimum": 1,
          "description": "Clue display number. Placeholder generator output may omit GridCell.number; use start coordinates as the authoritative clue anchor."
        },
        "clue": {
          "type": "string",
          "minLength": 1,
          "description": "Human-readable clue text shown to the player."
        },
        "answer_length": {
          "type": "integer",
          "minimum": 1,
          "description": "Number of letters in the correct answer."
        },
        "start": {
          "$ref": "#/definitions/ClueStart",
          "description": "Grid position of the first letter of the answer."
        },
        "answer": {
          "type": "string",
          "minLength": 1,
          "description": "Server-only at-rest answer string used by backend generation/scoring workflows. Never returned in public getLevel payloads."
        }
      }
    },

    "CluesJson": {
      "type": "object",
      "required": ["across", "down"],
      "additionalProperties": false,
      "properties": {
        "across": {
          "type": "array",
          "description": "All Across clues, ordered by clue number ascending.",
          "items": { "$ref": "#/definitions/Clue" },
          "minItems": 1
        },
        "down": {
          "type": "array",
          "description": "All Down clues, ordered by clue number ascending.",
          "items": { "$ref": "#/definitions/Clue" },
          "minItems": 1
        }
      }
    }

  },

  "notes": {
    "answerKeys": {
      "description": "When sending answers in submitScore, keys must be formatted as '<number><direction>' where direction is 'A' (Across) or 'D' (Down). Examples: '1A', '10D', '23A'.",
      "examples": ["1A", "1D", "2A", "10D"]
    },
    "cellCoverage": "For approved gameplay levels, every letter cell should belong to at least one Across and/or one Down clue. Phase-0 placeholder draft outputs may temporarily violate this before review/approval.",
    "clueNumberMapping": "The placeholder Phase-0 generator guarantees valid clue.start anchors but does not guarantee a strict one-to-one mapping between clue number and GridCell.number labels.",
    "symmetry": "Standard crossword grids use 180° rotational symmetry for black cells, but this is not enforced by this schema.",
    "serverOnly": "At rest, levels.clues_json clue entries may include server-only answer values. Public getLevel responses NEVER include answer strings; only clue text and answer_length are returned. The client must infer word positions from grid_json."
  }
}
